1. 数据预处理的做法
数据预处理是建模的基础，确保数据干净、结构化，便于优化。CSV文件有大量列（celebrity_name, season, results, weekX_judgeY_score等），行数多（每个参赛者一行）。预处理目标：为每个季节、每个周提取剩余参赛者、评委总分、排名/百分比、淘汰者。
步步讲解：
1. 加载数据：
  - 用pandas.read_csv加载'2026_MCM_Problem_C_Data.csv'。
  - 处理N/A和0：N/A用0填充（无分数），0表示已淘汰或无第四评委。
  - 注意：分数可能是float（小数，如平均分）。
2. 过滤季节和周：
  - 选定season（e.g., df_season = df[df['season'] == 1]）。
  - 确定每周剩余参赛者：遍历周（week1到week11，根据季节长度），检查results（e.g., "Eliminated Week X"表示在X周后淘汰，所以在X周还有分数）。
    - 规则：如果在该周有judge分数 >0，则剩余；0表示已淘汰。
    - 淘汰者：比较results，找该周结束时淘汰的（e.g., results含"Eliminated Week 4"的是week4淘汰者）。
  - 季节长度不同：用max周（无N/A）判断。
3. 计算评委总分和排名/百分比：
  - 对于每位剩余参赛者，计算周总分：sum(weekX_judge1 to judge4, ignore N/A)。
  - 排名（rank-based）：用scipy.stats.rankdata(总分, method='min'或'average'处理tie)，注意高分低rank（1最好）。
  - 百分比（percent-based）：个人总分 / 当周所有剩余总分 sum。
  - 处理tie：排名tie时平均（e.g., 两并列1，则rank=1.5）。
4. 提取特征和标签：
  - 特征：celebrity_age_during_season, celebrity_industry (one-hot编码), etc. 为后期ML准备。
  - 淘汰约束：标识淘汰者（单或多）。
5. 异常处理：
  - 多淘汰/无淘汰周：检查results计数。
  - 平分：添加epsilon小扰动避免严格相等。
  - 输出：为每个周生成DataFrame，含contestant, judge_total, judge_rank/percent, eliminated (True/False)。
6. 工具使用：
  - 用code_execution跑预处理代码，输出表验证。
  - 示例：对于season 1 week 4，剩余4人，淘汰Rachel Hunter。
预处理后，数据ready for优化。整个过程用时短（pandas高效），比赛中可写函数自动化。
2. 3-27季模型建立（百分比）
1. 总目标：对每一赛季每一周建立模型，估算：$$v_{i,t}$$，即每周每位选手真实观众投票数
2. 数据预处理：评委总分
  归一化：$$q_{i,t}=\frac{S_{i,t}}{\sum_{k\in R_t}S_{k,t}}$$
  $$S_{i,t}$$:第t周评委给第i个选手的打分（数据集中judge_total,已经聚合了四位评委的打分
  $$\sum_{k\in R_t}S_{k,t}$$ ：第t周评委给所有选手的打分之和（所有judge_total之和
  其中 $$R_t$$ 表示该周仍未淘汰的所有选手集合。
  $$q_{i,t}$$ 是评委对选手 $$i$$ 的打分比例
3. 观众投票建模：未知变量$$v_{i,t}$$
  由于总票数不公开，只需要估算投票比例：$$p_{i,t} = \frac{v_{i,t}}{\sum_{k \in R_t} v_{k,t}}$$
   $$v_{i,t}$$:观众t周给选手i的投票
  于是自动满足：$$\sum_{i \in R_t} p_{i,t} = 1$$（每个观众每周的投票次数不确定）
4. 综合得分模型（题目中最后的示例，给出的意思应该是权重为1：1）
  设评委权重为 $$\alpha$$=0.5，观众权重为 $$1-\alpha$$。
  综合得分为：$$T_{i,t}=\alpha q_{i,t}+(1-\alpha)p_{i,t}$$
5. 淘汰反推，需要建立约束 
  我看错了sos，placement是当季最终排名，只知道谁淘汰了，只有这一个约束。
  节目公开每周淘汰选手。设该周淘汰者为：$$e(t)$$
  则必须满足：$$T_{e(t),t} \leq T_{i,t}, \quad \forall i \in R_t$$（每一季每一周的选手排名）
  即淘汰者综合得分最低。代入综合得分公式：
  $$\alpha q_{e(t),t} + (1 - \alpha)p_{e(t),t} \leq \alpha q_{i,t} + (1 - \alpha)p_{i,t}$$

6. 仅靠“淘汰最低”约束，存在无穷解
  1. 平滑人气假设：观众支持通常不会每周剧烈变化，因此设：$$\min \sum_{i,t} (p_{i,t} - p_{i,t-1})^2$$，每一周观众投票的波动尽可能地减少。即这个人在本周所得票的占比和其他周没有剧烈变化。优化问题，使变化值求和最小。
    最后求出来是具体P值。
    - 若一个明星上周票很多，本周票不应突然归零
    - 在该种方法下，最后完整的建模为$$\begin{aligned}
\min_{p_{i,t}} \quad & \sum_{i,t} (p_{i,t} - p_{i,t-1})^2 \\\text{s.t.} \quad & \sum_{i \in R_t} p_{i,t} = 1 \\
& p_{i,t} \geq 0 \\
& T_{e(t),t} \leq T_{i,t}, \quad \forall i \\
& T_{i,t} = \alpha q_{i,t} + (1 - \alpha) p_{i,t}
\end{aligned}$$
7. 一致性衡量标准
  1. 淘汰命中率：设总淘汰周数为$$N$$，预测淘汰周数为$$M$$，则：$$Accuracy = \frac{M}{N}$$
  预测正确就是1，越大越好。（有约束，应该是完全准确的，感觉不用怎么提）
8. 每位参赛者在每周投票估计确定性是否一样？
  - 在满足约束下，某选手的投票上下界：$$p_{i,t}^{max}, \, p_{i,t}^{min}$$（即在其存活的所有周数中，他票数占比的最大值和最小值之差）
  - 不确定性：$$U_{i,t} = p_{i,t}^{max} - p_{i,t}^{min}$$
  若 $$U$$ 很大，说明：
  - 投票可能性范围宽  
  - 模型不确定性大
9. 投票总数的确定性
胡扯ing、、、、、按照节目收视率波动（（
3. 排名法
3.1 数据预处理
1. 评委排名：$$r_{i,t}^{j}$$。$$r_{i,t}^{j}$$=1,评委最喜欢，分数最高。
2. 粉丝排名：$$r_{i,t}^{f}$$。$$r_{i,t}^{f}$$=1,粉丝最喜欢。
3.3 粉丝投票建模：未知变量为排名
- 粉丝排名$$r_{i,t}^{f}$$  也是整数排列：{1,2,…,nt}  的一个全排列
- 1 = 最多票,$$n_t$$= 最少票
3.4 综合排名模型（最常见假设）
节目通常采用等权重简单相加：
$$rank_{i,t}^{comb}=r_{i,t}^{j}+r_{i,t}^{f}$$
然后按 rank^{comb}_{i,t} 升序排序（越小越好），综合排名最低者（或并列最低中被选中的那位）被淘汰。
3.5 淘汰反推约束（核心约束）
设第 t周实际被淘汰的选手为 e(t)，则必须满足：
$$rank_{e(t),t}^{comb} \le rank_{i,t}^{comb}$$
∀i∈Rt∖{e(t)}
即：综合排名中，e(t)必须是最低（或并列最低）之一。
注意：当出现并列时（多于一人综合排名相同），节目可能随机或由其他规则决定淘汰谁，此时约束退化为：
ranke(t),tcomb=min⁡i∈Rtranki,tcomb    rank^{comb}_{e(t),t} = \min_{i \in R_t} rank^{comb}_{i,t}    ranke(t),tcomb=mini∈Rtranki,tcomb
3.6 约束优化
粉丝对选手的喜好不会每周剧烈跳跃，因此相邻周的排名变化应尽量小。
优化目标：
$$\sum_{t} (r_{i,t} ^{f}- r_{i,t-1}^{f})^2$$
s.t.
- r⋅,tf 是 {1,…,nt} 的一个排列
- 淘汰约束：$$rank_{e(t),t}^{comb} \le rank_{i,t}^{comb}$$
对争议选手 i 的粉丝排名约束推导: Jerry Rice、Billy Ray Cyrus、Bristol Palin、Bobby Bones
已知争议选手粉丝排名很高，评委排名很低，但是他们仍然取得了好名次。
因为要保证 $$i$$ 不被淘汰，即：  
$$r^j_{i,t} + r^f_{i,t} \leq r^j_{e(t),t} + r^f_{e(t),t}$$
又因为 $$r^f_{e(t),t} \leq n_t$$（最差情况），所以要让不等式在最坏情况下仍然成立，必须：  
$$r^j_{i,t} + r^f_{i,t} \leq r^j_{e(t),t} + n_t$$
移项得：  
$$r^f_{i,t} \leq n_t + r^j_{e(t),t} - r^j_{i,t}$$
这就是粉丝排名上界（越小越靠前，所以这里是最大允许的排名数字）。
在排名法机制下，争议选手（如 Jerry Rice、Bobby Bones）能够在评委持续低分的情况下存活较长时间，主要依赖于粉丝投票排名必须长期维持在前列（通常前 30% 以内，甚至前 20%）。
通过计算每週“粉丝排名上界”，我们发现这些争议案例的粉丝支持强度远高于平均水平，且在关键淘汰周往往需要进入前 3 名才能避免被淘汰。
这说明排名法虽然对极端粉丝支持有一定“压缩”作用（不像百分比法那样可以出现 70% vs 5% 的悬殊差距），但仍然显著偏向人气，只要粉丝足够集中，就能让技术评分较低的选手长期存活。
3.7 投票占比的推导
用百分比法赛季（大致3–27季）里已经通过约束优化得到的、相对“可信度较高”的粉丝投票比例 pi,t  p_{i,t}  pi,t 作为有标签数据（训练集）
然后利用这些数据，去训练一个模型，来预测排名法赛季（1–2季 + 28–34季）里选手的粉丝投票比例
XGBOOST
对每个样本，提取以下特征（建议至少包含以下这些，越多越好）：
还要添加其百分比的排名顺序作为指标。
暂时无法在南开飞书文档外展示此内容
目标变量：本周粉丝投票比例 p_{i,t} （百分比法下已估计的值）
由于排名机制下粉丝投票的绝对数值与相对比例无法直接从排名约束中唯一确定，我们考虑利用百分比机制赛季（约第3–27季）中通过约束优化得到的粉丝投票比例作为监督信号，训练一个机器学习模型来预测排名机制赛季中选手的粉丝支持度。
模型以选手静态特征、当周评委表现、节目阶段信息等作为输入，采用XGBoost回归器进行训练。经交叉验证，该模型在已知赛季上表现出较好的拟合能力（R² ≈ 0.XX）。
将训练好的模型应用于排名机制赛季后，我们发现争议选手（如Jerry Rice、Bobby Bones）在关键存活周的预测粉丝比例普遍较高（通常>30%–50%），与通过排名约束得到的“必须维持前列排名”结论相吻合。这表明两种机制下粉丝支持的底层强度具有较强的一致性，也为后续两种计票方式的公平性对比提供了统一的度量基础。
3.8 一致性与确定性衡量
1. 一致性：
  - 淘汰命中率：Accuracy同上
  - 理想情况下应接近100%（因为加了硬约束）
2. 估计的确定性（不确定度）
对每位选手每週，统计所有满足约束的粉丝排名中 ri,tf    r^f_{i,t}    ri,tf 的范围：
3. Ui,tf=max ⁡ri,tf−min ⁡ri,tf(越小越确定)    同上